<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"      
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.teamproject.club_application.DB.iDaoMobile">
<!-- 맵핑 데이터 -->
<!-- 
<resultMap type="com.teamproject.club_application.data.ClubMemberClass" id="ClubMemberClass">
	<result property="club.id" column="id"/>
	<result property="club.category_id" column="category_id"/>
	<result property="club.member_id" column="member_id"/>
	<result property="club.image_id" column="image_id"/>
	<result property="club.name" column="name"/>
	<result property="club.local" column="local"/>
	<result property="club.max_people" column="max_people"/>
	<result property="club.intro" column="intro"/>
	<result property="club.create_date" column="create_date"/>
	<result property="memberClass" column="class"/>
</resultMap>
 -->
<!-- 맵핑 데이터 끝-->

<!-- oracle 쿼리문 작성 시작-->

<!-- 테스트 항목 -->
<select id="getTestData" resultType="com.teamproject.club_application.data.TestData">
	select * from TestData
</select>
<!-- 테스트 항목 끝 -->

<!-- 공통 항목 -->
<insert id="insertImage" parameterType="com.teamproject.club_application.data.Image"> 
	<selectKey keyProperty="id" resultType="Integer" order="BEFORE"> 
		select Image_seq.nextval from dual
	</selectKey>	
	insert into image values ( #{id}, #{img_db_name}, #{img_ori_name})
</insert>
<!-- 로그인 항목 끝 -->


<!-- 로그인 항목 -->
<select id="selectLoginUser" resultType="com.teamproject.club_application.data.Member">
	select * from Member where login_id=#{param1} and login_pw=#{param2}
</select>
<select id="refreshMemberInfo" resultType="com.teamproject.club_application.data.Member">
	select * from Member where id=#{param1}
</select>
<!-- 로그인 항목 끝 -->

<!-- 회원가입 항목 -->
<select id="checkId" resultType="Integer">
	select count(*) from Member where login_id=#{param1}
</select>

<insert id="insertMember" parameterType="com.teamproject.club_application.data.Member"> 
	<selectKey keyProperty="id" resultType="Integer" order="BEFORE"> 
		select member_seq.nextval from dual
	</selectKey>	
	insert into member values ( #{id}, #{login_id}, #{login_pw}, #{name}, #{birthday}, #{gender}, #{local}, #{phone}, #{verify})
</insert>

	<!-- 이메일 인증 -->
	
	<insert id="createAuth">
		insert into Auth values ( #{param1}, #{param2})
	</insert>	
	
	<select id="checkAuth" resultType="Integer">
		select count(*) from Auth A, Member m where A.login_id=#{param1} and A.key=#{param2} and m.verify='N'
	</select>
	
	<update id="updateAuth">
		update Member set VERIFY='Y' where login_id=#{param1}
	</update>	
	
	<delete id="deleteAuth">
		delete from auth where login_id=#{param1}
	</delete>
	
	<!-- 이메일 인증 끝 -->
<!-- 회원가입 항목 끝 -->

<!-- 정보찾기 항목 -->
<select id="selectFindId" resultType="String">
	select M.login_id from Member M where M.login_id=#{param1}
</select>
<select id="selectFindPw" resultType="Integer">
	select count(*) from Member M where M.login_id=#{param1}
</select>
<update id="updatePw">
	update Member set login_pw=#{param2} where login_id=#{param1}
</update>
	<!-- 임시 비밀번호 항목 -->
	
	<insert id="createTmpPw">
		insert into tmp_pw values ( #{param1}, #{param2})
	</insert>	
	
	<select id="checkTmpPw" resultType="Integer">
		select count(*) from tmp_pw A where A.login_id=#{param1} and A.pw=#{param2}
	</select>
	
	<delete id="deleteTmpPw">
		delete from tmp_pw where login_id=#{param1}
	</delete>
	
	<!-- 임시 비밀번호 항목 끝 -->
<!-- 정보찾기 항목 끝 -->

<!-- 메뉴 항목 -->
<select id="selectMyAlarm" resultType="com.teamproject.club_application.data.Alarm">
	select * from Alarm where member_id=#{param1}
</select>

<select id="selectMyPost" resultType="com.teamproject.club_application.data.Post">
	select * from Post where member_id=#{param1}
</select>

<select id="selectMyComment" resultType="com.teamproject.club_application.data.Comment">
	select * from Comments where member_id=#{param1}
</select>

<select id="selectMySchedule" resultType="com.teamproject.club_application.data.Schedule">
	select S.* from schedule S, schedule_member SM where S.start_date>=sysdate and S.id=SM.schedule_id and SM.member_id=#{param1}
</select>

<select id="selectMyClub" resultType="com.teamproject.club_application.data.Club">
	select * from Club where member_id=#{param1}
</select>

<select id="selectMyDaySchedule" resultType="com.teamproject.club_application.data.Schedule">
	select S.* 
	from schedule S, schedule_member SM  
	where S.start_date BETWEEN TO_DATE(#{param2}, 'yyyymmdd') and (TO_DATE(#{param2}, 'yyyymmdd')+1-(1/(24*60*60))) 
		and S.id=SM.schedule_id and SM.member_id=#{param1}
</select>
<!-- 메뉴 항목 끝 -->


<!-- 클럽 항목 -->
<insert id="insertClub" parameterType="com.teamproject.club_application.data.Club"> 
	<selectKey keyProperty="id" resultType="Integer" order="BEFORE"> 
		select club_seq.nextval from dual
	</selectKey>	
	insert into club values ( #{id}, #{category_id}, #{member_id}, #{image_id}, #{name}, #{local}, #{max_people}, #{intro}, sysdate)
</insert>

<select id="selectClub" resultType="com.teamproject.club_application.data.Club">
	select C.*
	from Club C
	where C.id = #{param1}
</select>

<select id="selectClubMemberClass" resultType="String">
	select CM.class
	from Club_Member CM
	where CM.club_id = #{param1} and CM.member_id = #{param2} 
</select>

<insert id="joinClub"> 
	insert into club_member values(club_member_seq.nextval, #{param1}, #{param2}, #{param3})
	
</insert>
<!-- 클럽 항목 끝 -->

<!-- oracle 쿼리문 작성 끝-->
</mapper>




<!-- 	
    public ArrayList<Alarm> selectMyAlarm(Long userId);
    public ArrayList<Post> selectMyPost(Long userId);
    public ArrayList<Comment> selectMyComment(Long userId);
    public ArrayList<Schedule> selectMySchedule(Long userId);
    public ArrayList<Club> selectMyClub(Long userId);
 -->